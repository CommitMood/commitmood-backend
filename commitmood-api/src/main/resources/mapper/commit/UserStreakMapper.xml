<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.commitmood.domain.commit.mapper.UserStreakMapper">

    <!-- DailyCommitCountDto ResultMap -->
    <resultMap id="dailyCommitCountResultMap"
               type="com.ssafy.commitmood.domain.commit.dto.DailyCommitCountDto">
        <result property="commitDate" column="commit_date"/>
        <result property="commitCount" column="commit_count"/>
    </resultMap>

    <!-- 특정 기간 동안 사용자의 일별 커밋 수 조회 -->
    <select id="findDailyCommitCounts" resultMap="dailyCommitCountResultMap">
        SELECT
            CAST(committed_at AS DATE) as commit_date,
            COUNT(*) as commit_count
        FROM commit_log
        WHERE user_account_id = #{userAccountId}
          AND CAST(committed_at AS DATE) BETWEEN #{startDate} AND #{endDate}
        GROUP BY CAST(committed_at AS DATE)
        ORDER BY commit_date ASC
    </select>

    <!-- 사용자의 총 커밋 일수 조회 -->
    <select id="countTotalCommitDays" resultType="java.lang.Integer">
        SELECT COUNT(DISTINCT CAST(committed_at AS DATE))
        FROM commit_log
        WHERE user_account_id = #{userAccountId}
          AND CAST(committed_at AS DATE) BETWEEN #{startDate} AND #{endDate}
    </select>

</mapper>