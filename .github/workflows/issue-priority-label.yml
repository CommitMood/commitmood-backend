name: Issue Priority Label

on:
  issues:
    types: [opened, edited, reopened]

jobs:
  label-priority:
    runs-on: ubuntu-latest
    steps:
      - name: Check Priority and Add Label
        uses: actions/github-script@v6
        with:
          script: |
            const body = context.payload.issue.body || '';
            const currentLabels = context.payload.issue.labels.map(l => l.name);
            
            // Priority ë¼ë²¨ ëª©ë¡
            const priorityLabels = ['P0', 'P1', 'P2', 'P3'];
            
            // ì²´í¬ëœ Priority ì°¾ê¸°
            let checkedPriority = null;
            
            if (body.includes('- [x] P0') || body.includes('- [X] P0')) {
              checkedPriority = 'P0';
            } else if (body.includes('- [x] P1') || body.includes('- [X] P1')) {
              checkedPriority = 'P1';
            } else if (body.includes('- [x] P2') || body.includes('- [X] P2')) {
              checkedPriority = 'P2';
            } else if (body.includes('- [x] P3') || body.includes('- [X] P3')) {
              checkedPriority = 'P3';
            }
            
            if (!checkedPriority) {
              console.log('âš ï¸ Priorityê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
              return;
            }
            
            // ê¸°ì¡´ Priority ë¼ë²¨ ì œê±°
            const labelsToRemove = currentLabels.filter(label => 
              priorityLabels.includes(label) && label !== checkedPriority
            );
            
            for (const label of labelsToRemove) {
              await github.rest.issues.removeLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                name: label
              });
              console.log(`ğŸ—‘ï¸ Removed label: ${label}`);
            }
            
            // ìƒˆë¡œìš´ Priority ë¼ë²¨ ì¶”ê°€
            if (!currentLabels.includes(checkedPriority)) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                labels: [checkedPriority]
              });
              console.log(`âœ… Added label: ${checkedPriority}`);
            } else {
              console.log(`âœ“ Label already exists: ${checkedPriority}`);
            }