<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.commitmood.mapper.commit.CommitFileChangeMapper">

    <resultMap id="CommitFileChangeResultMap" type="com.commitmood.domain.commit.CommitFileChange">
        <id property="id" column="id"/>
        <result property="commitId" column="commit_id"/>
        <result property="filename" column="filename"/>
        <result property="status" column="status"
                typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
        <result property="additions" column="additions"/>
        <result property="deletions" column="deletions"/>
        <result property="changes" column="changes"/>
        <result property="patch" column="patch"/>
        <result property="previousFilename" column="previous_filename"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <insert id="insert" parameterType="com.commitmood.domain.commit.CommitFileChange"
            useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO commit_file_change (commit_id,
                                        filename,
                                        status,
                                        additions,
                                        deletions,
                                        changes,
                                        patch,
                                        previous_filename)
        VALUES (#{commitId},
                #{filename},
                #{status, typeHandler=org.apache.ibatis.type.EnumTypeHandler},
                #{additions},
                #{deletions},
                #{changes},
                #{patch},
                #{previousFilename})
    </insert>

    <insert id="insertBatch" parameterType="java.util.List">
        INSERT INTO commit_file_change (
        commit_id,
        filename,
        status,
        additions,
        deletions,
        changes,
        patch,
        previous_filename
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
            #{item.commitId},
            #{item.filename},
            #{item.status, typeHandler=org.apache.ibatis.type.EnumTypeHandler},
            #{item.additions},
            #{item.deletions},
            #{item.changes},
            #{item.patch},
            #{item.previousFilename}
            )
        </foreach>
    </insert>

    <select id="findById" resultMap="CommitFileChangeResultMap">
        SELECT *
        FROM commit_file_change
        WHERE id = #{id}
    </select>

    <select id="findByCommitId" resultMap="CommitFileChangeResultMap">
        SELECT *
        FROM commit_file_change
        WHERE commit_id = #{commitId}
        ORDER BY filename
    </select>

    <update id="update" parameterType="com.commitmood.domain.commit.CommitFileChange">
        UPDATE commit_file_change
        SET filename = #{filename},
            status = #{status, typeHandler=org.apache.ibatis.type.EnumTypeHandler},
            additions = #{additions},
            deletions = #{deletions},
            changes = #{changes},
            patch = #{patch},
            previous_filename = #{previousFilename}
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM commit_file_change
        WHERE id = #{id}
    </delete>

    <delete id="deleteByCommitId">
        DELETE FROM commit_file_change
        WHERE commit_id = #{commitId}
    </delete>

</mapper>