<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.commitmood.domain.github.mapper.GithubRepoMapper">

    <resultMap id="githubRepoResultMap" type="com.ssafy.commitmood.domain.github.entity.GithubRepo">
        <id property="id" column="ID"/>
        <result property="userAccountId" column="USER_ACCOUNT_ID"/>
        <result property="githubRepoId" column="GITHUB_REPO_ID"/>
        <result property="githubRepoName" column="GITHUB_REPO_NAME"/>
        <result property="githubRepoFullName" column="GITHUB_REPO_FULL_NAME"/>
        <result property="defaultBranch" column="DEFAULT_BRANCH"/>
        <result property="description" column="DESCRIPTION"/>
        <result property="githubRepoUrl" column="GITHUB_REPO_URL"/>
        <result property="isPrivate" column="IS_PRIVATE"/>
        <result property="lastSyncedAt" column="LAST_SYNCED_AT"/>
        <result property="createdAt" column="CREATED_AT"/>
        <result property="updatedAt" column="UPDATED_AT"/>
    </resultMap>

    <!-- INSERT -->
    <insert id="insert" parameterType="com.ssafy.commitmood.domain.github.entity.GithubRepo"
            useGeneratedKeys="true" keyProperty="id" keyColumn="ID">
        INSERT INTO GITHUB_REPO (
        USER_ACCOUNT_ID,
        GITHUB_REPO_ID,
        GITHUB_REPO_NAME,
        GITHUB_REPO_FULL_NAME,
        DEFAULT_BRANCH,
        DESCRIPTION,
        GITHUB_REPO_URL,
        IS_PRIVATE,
        LAST_SYNCED_AT,
        CREATED_AT,
        UPDATED_AT
        ) VALUES (
        #{userAccountId},
        #{githubRepoId},
        #{githubRepoName},
        #{githubRepoFullName},
        #{defaultBranch},
        #{description},
        #{githubRepoUrl},
        #{isPrivate},
        #{lastSyncedAt},
        CURRENT_TIMESTAMP,
        CURRENT_TIMESTAMP
        )
    </insert>

    <!-- UPDATE -->
    <update id="update" parameterType="com.ssafy.commitmood.domain.github.entity.GithubRepo">
        UPDATE GITHUB_REPO
        SET GITHUB_REPO_NAME = #{githubRepoName},
        DEFAULT_BRANCH = #{defaultBranch},
        DESCRIPTION = #{description},
        GITHUB_REPO_URL = #{githubRepoUrl},
        IS_PRIVATE = #{isPrivate},
        LAST_SYNCED_AT = #{lastSyncedAt},
        UPDATED_AT = CURRENT_TIMESTAMP
        WHERE ID = #{id}
    </update>

    <!-- SELECT BY ID -->
    <select id="findById" resultMap="githubRepoResultMap">
        SELECT *
        FROM GITHUB_REPO
        WHERE ID = #{id}
    </select>

    <!-- SELECT BY GITHUB_REPO_ID -->
    <select id="findByGithubRepoId" resultMap="githubRepoResultMap">
        SELECT *
        FROM GITHUB_REPO
        WHERE GITHUB_REPO_ID = #{githubRepoId}
    </select>

    <!-- SELECT BY GITHUB_REPO_FULL_NAME -->
    <select id="findByGithubRepoFullName" resultMap="githubRepoResultMap">
        SELECT *
        FROM GITHUB_REPO
        WHERE GITHUB_REPO_FULL_NAME = #{githubRepoFullName}
    </select>

    <!-- SELECT ALL BY USER_ACCOUNT_ID -->
    <select id="findAllByUserAccountId" resultMap="githubRepoResultMap">
        SELECT *
        FROM GITHUB_REPO
        WHERE USER_ACCOUNT_ID = #{userAccountId}
        ORDER BY CREATED_AT DESC
    </select>

    <!-- SELECT ALL BY USER_ACCOUNT_ID AND PRIVACY -->
    <select id="findAllByUserAccountIdAndPrivacy" resultMap="githubRepoResultMap">
        SELECT *
        FROM GITHUB_REPO
        WHERE USER_ACCOUNT_ID = #{userAccountId}
        AND IS_PRIVATE = #{isPrivate}
        ORDER BY CREATED_AT DESC
    </select>

    <!-- SELECT ALL -->
    <select id="findAll" resultMap="githubRepoResultMap">
        SELECT *
        FROM GITHUB_REPO
        ORDER BY CREATED_AT DESC
    </select>

    <!-- DELETE BY ID -->
    <delete id="deleteById">
        DELETE FROM GITHUB_REPO
        WHERE ID = #{id}
    </delete>

    <!-- EXISTS BY GITHUB_REPO_ID -->
    <select id="existsByGithubRepoId" resultType="boolean">
        SELECT COUNT(*) > 0
        FROM GITHUB_REPO
        WHERE GITHUB_REPO_ID = #{githubRepoId}
    </select>

    <!-- COUNT BY USER_ACCOUNT_ID -->
    <select id="countByUserAccountId" resultType="int">
        SELECT COUNT(*)
        FROM GITHUB_REPO
        WHERE USER_ACCOUNT_ID = #{userAccountId}
    </select>

</mapper>